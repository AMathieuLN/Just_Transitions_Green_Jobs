"0","# Préparer les données : ajouter des variations annuelles et identifier les inflexions"
"0","evolution_data <- selected_outliers %>%"
"0","  arrange(iso3c, year) %>%"
"0","  group_by(iso3c) %>%"
"0","  mutate("
"0","    year = as.integer(year),  # Convertir les années en entiers pour supprimer les décimales"
"0","    annual_change = JTS - lag(JTS),  # Variation annuelle du score"
"0","    significant_change = ifelse(abs(annual_change) > 5, ""Inflexion"", ""Stable""),  # Seuil de variation significative"
"0","    income_group_label = case_when(  # Ajouter des labels textuels pour les groupes de revenu"
"0","      income_group_num == 1 ~ ""Revenu élevé"","
"0","      income_group_num == 2 ~ ""Revenu intermédiaire supérieur"","
"0","      income_group_num == 3 ~ ""Revenu intermédiaire inférieur"","
"0","      income_group_num == 4 ~ ""Faible revenu"""
"0","    ),"
"0","    country_label = paste0(iso3c, "" ("", income_group_label, "")"")  # Ajouter le nom du pays et groupe de revenu"
"0","  ) %>%"
"0","  filter(!is.na(significant_change))  # Supprimer les NA de ""Type de changement"""
"0",""
"0","# Créer le graphique"
"0","trend_plot <- ggplot(evolution_data, aes(x = year, y = JTS, group = iso3c, color = country_label)) +"
"0","  geom_line(size = 1) +  # Lignes pour chaque pays"
"0","  geom_point(aes(size = abs(annual_change), shape = significant_change), alpha = 0.7) +  # Points pour chaque année"
"0","  scale_size_continuous(range = c(2, 6)) +  # Échelle de la taille des points"
"0","  scale_shape_manual("
"0","    values = c(""Inflexion"" = 17, ""Stable"" = 16),  # Triangle pour inflexion, cercle pour stable"
"0","    name = ""Type de changement"""
"0","  ) +"
"0","  scale_x_continuous("
"0","    breaks = seq(2011, 2022, by = 1),  # Forcer les années entières comme graduations"
"0","    labels = seq(2011, 2022, by = 1)   # Utiliser des années comme étiquettes"
"0","  ) +"
"0","  labs("
"0","    title = """","
"0","    x = ""Année"","
"0","    y = ""Just Transition Score (JTS)"","
"0","    color = ""Pays (Groupe de revenu)"","
"0","    size = ""Amplitude du changement"","
"0","    shape = ""Type de changement"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    legend.position = ""right"","
"0","    legend.text = element_text(size = 10),"
"0","    panel.grid = element_line(color = ""grey90""),"
"0","    plot.title = element_text(size = 14, face = ""bold"")"
"0","  )"
"0",""
"0","# Afficher le graphique"
"0","print(trend_plot)"
